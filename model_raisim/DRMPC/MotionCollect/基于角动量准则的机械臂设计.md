# 基于角动量准则的机械臂设计

## 研究背景

## 研究思路

![研究思路](https://s2.loli.net/2022/05/31/TSvWFe35kop4HXn.png)

## 研究方法

### 角动量假设验证

#### 角动量假设与猜想

##### 假设

1. 手臂在人体运动时的摆动可以<font color='red'>抵消腿产生的角动量或者可延缓身体角动量的增加</font>，给予<font color='red'>更长的时间</font>帮助身体恢复平衡。

##### 角动量<font color='red'>期望与猜想</font>

1. 局部作用（比例关系）
   $$
   \frac{L_{arm}}{L_{leg}}=K、\frac{L_{arm}}{L_{trunk}}=K......
   $$

2. 全局作用
   $$
   L_{arm}+L_{leg}+L_{trunk}=N
   $$
   

#### 人体运动动力学

##### 二维平面内的人体运动动力学方程

<img src="https://s2.loli.net/2022/06/12/OjWBhnSI5k7uxwN.png" alt="human2D - 副本.drawio" style="zoom:67%;" />
$$
\begin{bmatrix} 
M_{11} &M_{12} &M_{13} &M_{14} &M_{15} &M_{16} &M_{17}\\
M_{21} &M_{22} &M_{23} &M_{24} &M_{25} &M_{26} &M_{27}\\
M_{31} &M_{32} &M_{33} &M_{34} &M_{35} &M_{36} &M_{37}\\
M_{41} &M_{42} &M_{43} &M_{44} &M_{45} &M_{46} &M_{47}\\
M_{51} &M_{52} &M_{53} &M_{54} &M_{55} &M_{56} &M_{57}\\
M_{61} &M_{62} &M_{63} &M_{64} &M_{65} &M_{66} &M_{67}\\
M_{71} &M_{72} &M_{73} &M_{74} &M_{75} &M_{76} &M_{77}\\
\end{bmatrix} 
\begin{bmatrix} 
\ddot{x}\\ 
\ddot{z}\\ 
\ddot{\theta}_1\\ 
\ddot{\theta}_2\\
\ddot{\theta}_3\\
\ddot{\theta}_4\\
\ddot{\theta}_5\\
\end{bmatrix} + 
\begin{bmatrix} 
C_1\\ 
C_2\\ 
C_3\\
C_4\\
C_5\\
C_6\\
C_7\\
\end{bmatrix} + 
\begin{bmatrix} 
G_1\\
G_2\\ 
G_3\\
G_4\\
G_5\\
G_6\\
G_7\\
\end{bmatrix} =
\begin{bmatrix} 
F_x\\
F_z\\ 
\tau_1\\
\tau_2\\
\tau_3\\
\tau_4\\
\tau_5\\
\end{bmatrix}
$$

$$
\left\{
\begin{aligned}
M_{11} &=
m_1+_2+m_3+m_4+m_5 \\
M_{12} &= 0\\
M_{13} &=
-m_2l_1C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{14} &=
l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{15} &=M_{13}=
-m_2l_1C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{16} &=M_{14}=
l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{17} &=M_{13}=
-m_2l_1C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{21} &= 0\\
M_{22} &=
m_1+m_2+m_3+m_4+m_5 \\
M_{23} &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
M_{24} &=
-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5C_{1,1}\\
M_{25} &=M_{23}=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
M_{26} &=M_{24}=
-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5C_{1,1}\\
M_{27} &=M_{23}=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{31} &=
-l_1m_2C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{32} &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
M_{33} &= 
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
M_{34} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
M_{35} &=
M_{33}\\
M_{36} &=
M_{34}\\
M_{37} &=
M_{33}\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{41} &=
M_{14}\\
M_{42} &=
M_{24}\\
M_{43} &= 
M_{34}\\
M_{44} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2\\
M_{45} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
M_{46} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2\\\\
M_{47} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{51} &=
M_{15}\\
M_{52} &=
M_{25}\\
M_{53} &= 
M_{35}\\
M_{54} &=
M_{45}\\
M_{55} &=
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
M_{56} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
M_{57} &=
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{61} &=
M_{16}\\
M_{62} &=
M_{26}\\
M_{63} &= 
M_{36}\\
M_{64} &=
M_{46}\\
M_{65} &=
M_{56}\\
M_{66} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2\\
M_{67} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{71} &=
M_{17}\\
M_{72} &=
M_{27}\\
M_{73} &= 
M_{37}\\
M_{74} &=
M_{47}\\
M_{75} &=
M_{57}\\
M_{76} &=
M_{67}\\
M_{77} &=
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
G_1 &=0\\
G_2 &=
m_1+m_2+m_3+m_4+m_5\\
G_3 &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-2l_3m_3S_{1,1}-l_4m_4S_{1,2}-2l_5m_5S_{1,1}\\
G_4 &=
-l_2m_2S_{1,2}-l_4m_4S_{1,2}\\
G_5 &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-2l_3m_3S_{1,1}-l_4m_4S_{1,2}-2l_5m_5S_{1,1}\\
G_6 &=
-l_2m_2S_{1,2}-l_4m_4S_{1,2}\\
G_7 &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-2l_3m_3S_{1,1}-l_4m_4S_{1,2}-2l_5m_5S_{1,1}\\
\end{aligned}
\right.
$$

##### 角动量计算方法

![antcal](https://s2.loli.net/2022/06/16/vEDaFkB2iTM6t5o.png)

<img src="https://s2.loli.net/2022/06/16/Lqc5WsfjkMUunpX.png" alt="antcal1" style="zoom: 67%;" />

<img src="https://s2.loli.net/2022/06/16/1tuCZpSUMNHyi89.png" alt="antcal2" style="zoom:67%;" />

<img src="https://s2.loli.net/2022/06/16/eKPbGTodmrA6a4c.png" alt="antcal3" style="zoom:67%;" />

- 二连杆角动量计算验证

  <img src="https://s2.loli.net/2022/06/21/bDZYFnHgAt2BkWL.png" alt="而来杠杆" style="zoom:67%;" />

  1. 二连杆运动学方程
     $$
     \left\{
     \begin{aligned}
     x_1 &= l_{c1}C_1 = \frac{1}{2}l_1C_1 \\
     y_1 &= l_{c1}S_1 = \frac{1}{2}l_1S_1\\
     x_2 &= l_1C_1+l_{c2}C_{1,2} = l_1C_1+\frac{1}{2}l_2C_{1,2} \\
     y_2 &= l_1S_1+l_{c2}S_{1,2} = l_1S_1+\frac{1}{2}l_2S_{1,2} \\
     \end{aligned}
     \right. \qquad \qquad \qquad
     \left\{
     \begin{aligned}
     \dot{x}_1 &= -l_{c1}S_1\dot{\theta}_1 = -\frac{1}{2}l_1S_1\dot{\theta}_1 \\
     \dot{y}_1 &= l_{c1}C_1\dot{\theta}_1 = \frac{1}{2}l_1C_1\dot{\theta}_1\\
     \dot{x}_2 &= -l_1S_1\dot{\theta}_1-l_{c2}S_{1,2}(\dot{\theta}_1+\dot{\theta}_2) = -l_1S_1\dot{\theta}_1-\frac{1}{2}l_2S_{1,2}(\dot{\theta}_1+\dot{\theta}_2)  \\
     \dot{y}_2 &= l_1C_1\dot{\theta}_1+l_{c2}C_{1,2}(\dot{\theta}_1+\dot{\theta}_2)  = l_1C_1\dot{\theta}_1+\frac{1}{2}l_2C_{1,2}(\dot{\theta}_1+\dot{\theta}_2)  \\
     \end{aligned}
     \right.
     $$

  2. 动力学方程
     $$
     \begin{bmatrix}
     M_{11} &M_{12}\\
     M_{21} &M_{22}\\
     \end{bmatrix} + 
     \begin{bmatrix}
     C_{1}\\
     C_{2}\\
     \end{bmatrix} + 
     \begin{bmatrix}
     G_{1}\\
     G_{2}\\
     \end{bmatrix} =
     \begin{bmatrix}
     \tau_{1}\\
     \tau_{2}\\
     \end{bmatrix}
     $$

     $$
     \left\{
     \begin{aligned}
     M_{11} &= m_2l_1^2+\frac{1}{3}m_1l_1^2+\frac{1}{3}m_2l_2^2+m_2l_1l_2C_2 \\
     &=m_1l_{c1}^2+m_2(l_1^2+l_{c2}^2+2l_1l_{c2}C_2)+I_1+I_2\\
     M_{12}&=\frac{1}{3}m_2l_2^2+\frac{1}{2}m_2l_1l_2C_2 \\
     &=m_2(l_{c2}^2+l_1l_{c2}C_2)+I_2\\
     &=M_{21}\\
     M_{22}&=\frac{1}{3}m_2l_2^2\\
     &=m_2l_{c2}^2+I_2\\
     \end{aligned}
     \right.
     $$

     $$
     \left\{
     \begin{aligned}
     C_{1} &= -m_2l_1l_2S_2\dot{\theta}_1\dot{\theta}_2- \frac{1}{2}m_2l_1l_2S_2\dot{\theta}_2^2\\
     &=-2m_2l_1l_{c2}S_2\dot{\theta}_1\dot{\theta}_2-m_2l_1l_{c2}S_2\dot{\theta}_2^2\\
     C_{2}&= \frac{1}{2}m_2l_1l_2S_2\dot{\theta}_1^2\\
     &=m_2l_1l_{c2}S_2\dot{\theta}_1^2\\
     \end{aligned}
     \right.
     $$

     $$
     \left\{
     \begin{aligned}
     G_{1} &= (\frac{1}{2}m_1+m_2)gl_1C_1+\frac{1}{2}m_2gl_2C_{1,2}\\
     &=(m_1l_{c1}+m_2l_1)gC_1+m_2gl_{c2}C_{1,2}\\
     G_{2}&= \frac{1}{2}m_2gl_2C_{1,2}\\
     &=m_2gl_{c2}C_{1,2}\\
     \end{aligned}
     \right.
     $$

  3. 通过求相对于原点的总角动量（即$L = L_1+L_2$)然后对L进行求导便可以得到相对于关节1的动力学方程，即上式的第一行。

#### 人体数据和数据采集设备

##### 人体数据

| 部分 | 重量占比 | 长度占比         | 重量（70kg） | 长度（1.75m） |
| ---- | -------- | ---------------- | ------------ | ------------- |
| 躯干 | 43.02%   | 30%              | 30.114       | 0.525         |
| 头劲 | 6.81%    | 10.75%           | 4.767        | 0.188         |
| 上臂 | 2.63%    | 17.25%           | 1.841        | 0.302         |
| 前臂 | 1.5%     | 15.85%+5.75%(手) | 1.05         | 0.277+0.1     |
| 双臂 | 9.43%    |                  | 6.601        |               |
| 大腿 | 14.47%   | 24.05%           | 10.129       | 0.42          |
| 小腿 | 4.57%    | 25.2%+4.25%(足)  | 3.199        | 0.441+0.074   |
| 双腿 | 40.74%   |                  | 28.518       |               |

##### calc文件中序号和关节对应

| 关节            | 数据序号 |
| --------------- | -------- |
| hips            | 1        |
| right up leg    | 2        |
| right lower leg | 3        |
| right foot      | 4        |
| left up leg     | 5        |
| left lower leg  | 6        |
| left foot       | 7        |
| right shoulder  | 8        |
| right up arm    | 9        |
| right forearm   | 10       |
| right hand      | 11       |
| left shoulder   | 12       |
| left up arm     | 13       |
| left forearm    | 14       |
| left hand       | 15       |
| head            | 16       |
| neck            | 17       |

##### 坐标系定义
1. BVH-Global坐标准则下的世界坐标系及各关节坐标系（局部坐标系由于传感器穿戴会存在差异，并非始终为下图所示）

2. 世界坐标系（x 指向北方， y 指向东方， z 指向下方）

   <img src="https://s2.loli.net/2022/06/16/x8pfkV2D9FQlrg4.png" alt="bvh" style="zoom: 50%;" />

   <img src="https://s2.loli.net/2022/06/08/h5L34fyHFrmWoiS.png" alt="human3D_walk_axis.drawio" style="zoom: 50%;" />	

#### 正常步态下角动量数据化
##### walk步态下基于hip局部坐标的角动量测试

1. 数据结果

   <img src="https://s2.loli.net/2022/06/16/2yJWl7SrRCZduhM.png" alt="hip-ant" style="zoom: 67%;" />

   <img src="https://s2.loli.net/2022/06/16/KyZe3igb1DTzNsH.png" alt="hip-antsum" style="zoom:67%;" />
   
2. 数据结果分析

   问题：

   1. 给予hip局部坐标系的话是非惯性坐标系，当身体相对于惯性坐标系有速度和加速度时，由于矢量相加导致其他部分的速度并非简单的常数相加，涉及到矢量加乘，会导致结果产生差异，因此产生的结果不具有说服力。
   2. 周期内<font color='red'>角动量之和有什么意义</font>？<font color='DeepSkyBlue' size='6'>(>_<)有点自己的想法，OK？不要别人说什么你就做什么！！！</font>

##### walk步态下相对于支撑脚（惯性系下）坐标系的角动量测试

- 基于支撑脚局部坐标初步测试（相对于世界坐标系矢量加减），因此由于运动朝向和世界坐标系下的xy方向不同，因此该测试下只有绕z轴方向的角动量有参考意义，结果如下

  <img src="https://s2.loli.net/2022/06/16/hQodRXTs1kNqOvP.png" alt="ant" style="zoom:67%;" />

  <img src="https://s2.loli.net/2022/06/16/FkHKUawDSBhWRsv.png" alt="antsum" style="zoom: 50%;" />

  1. 结果数据分析



- walk步态下手臂摆动和束缚时的运动对比

  - **手臂摆动**：左脚为支撑点)

  ![antwalkarm2 - 副本](https://s2.loli.net/2022/06/17/PAWLu54wEzejM8a.png)

  - **手臂束缚**(左脚为支撑点)

    ![antwalknoarmL2-2](https://s2.loli.net/2022/06/20/mNoX8iFTK3pxhEk.png)

  2. 力/加速度对比

     **手臂摆动**：左脚为支撑点)

     <img src="https://s2.loli.net/2022/06/20/NuXYJiUH6Kxnsj4.png" alt="force-arm" style="zoom: 67%;" />

     **手臂束缚**：左脚为支撑点)

     <img src="https://s2.loli.net/2022/06/20/LNl2xYoq46keST7.png" alt="force-noarm" style="zoom:67%;" />

  - 结果分析
    1. 手臂摆动时，<font color='red'>手臂的角动量方向与身体的角动量方向相同，与腿的相反</font>，这就意味着，<font color='red'>身体和手臂的运动作用可以抵消腿部运动产生的角动量</font>，维持身体平衡。
    2. 腿摆动的角动量幅值大约是手臂的2-3倍。
    3. 好奇一点：<font color='DeepSkyBlue'>为什么右腿和左腿的角动量方向不同?</font>
    4. 手臂束缚时，<font color = 'red'>身体的角动量几乎为零，意味着手臂不摆动时，没有额外角动量可以抵消腿部产生的角动量</font>。
    5. 另外一点：直觉不应该是束缚时躯干的角动量和腿的相反，臂不束缚更大？

