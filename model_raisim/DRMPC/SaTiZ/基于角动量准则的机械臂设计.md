# 基于角动量准则的机械臂设计

## 研究背景

## 研究思路

![研究思路](https://s2.loli.net/2022/05/31/TSvWFe35kop4HXn.png)

## 研究方法

### 角动量假设验证

#### 角动量假设与猜想

##### 假设

1. 手臂在人体运动时的摆动可以<font color='red'>抵消腿产生的角动量或者可延缓身体角动量的增加</font>，给予<font color='red'>更长的时间</font>帮助身体恢复平衡。

##### 角动量<font color='red'>期望与猜想</font>

1. 局部作用（比例关系）
   $$
   \frac{L_{arm}}{L_{leg}}=K、\frac{L_{arm}}{L_{trunk}}=K......
   $$

2. 全局作用
   $$
   L_{arm}+L_{leg}+L_{trunk}=N
   $$
   

#### 人体运动动力学

##### 二维平面内的人体运动动力学方程

<img src="https://s2.loli.net/2022/06/12/OjWBhnSI5k7uxwN.png" alt="human2D - 副本.drawio" style="zoom:67%;" />
$$
\begin{bmatrix} 
M_{11} &M_{12} &M_{13} &M_{14} &M_{15} &M_{16} &M_{17}\\
M_{21} &M_{22} &M_{23} &M_{24} &M_{25} &M_{26} &M_{27}\\
M_{31} &M_{32} &M_{33} &M_{34} &M_{35} &M_{36} &M_{37}\\
M_{41} &M_{42} &M_{43} &M_{44} &M_{45} &M_{46} &M_{47}\\
M_{51} &M_{52} &M_{53} &M_{54} &M_{55} &M_{56} &M_{57}\\
M_{61} &M_{62} &M_{63} &M_{64} &M_{65} &M_{66} &M_{67}\\
M_{71} &M_{72} &M_{73} &M_{74} &M_{75} &M_{76} &M_{77}\\
\end{bmatrix} 
\begin{bmatrix} 
\ddot{x}\\ 
\ddot{z}\\ 
\ddot{\theta}_1\\ 
\ddot{\theta}_2\\
\ddot{\theta}_3\\
\ddot{\theta}_4\\
\ddot{\theta}_5\\
\end{bmatrix} + 
\begin{bmatrix} 
C_1\\ 
C_2\\ 
C_3\\
C_4\\
C_5\\
C_6\\
C_7\\
\end{bmatrix} + 
\begin{bmatrix} 
G_1\\
G_2\\ 
G_3\\
G_4\\
G_5\\
G_6\\
G_7\\
\end{bmatrix} =
\begin{bmatrix} 
F_x\\
F_z\\ 
\tau_1\\
\tau_2\\
\tau_3\\
\tau_4\\
\tau_5\\
\end{bmatrix}
$$

$$
\left\{
\begin{aligned}
M_{11} &=
m_1+_2+m_3+m_4+m_5 \\
M_{12} &= 0\\
M_{13} &=
-m_2l_1C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{14} &=
l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{15} &=M_{13}=
-m_2l_1C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{16} &=M_{14}=
l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{17} &=M_{13}=
-m_2l_1C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{21} &= 0\\
M_{22} &=
m_1+m_2+m_3+m_4+m_5 \\
M_{23} &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
M_{24} &=
-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5C_{1,1}\\
M_{25} &=M_{23}=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
M_{26} &=M_{24}=
-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5C_{1,1}\\
M_{27} &=M_{23}=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{31} &=
-l_1m_2C_1-l_1m_3C_1+l_1m_4C_1+l_1m_5C_1+l_2m_2C_{1,2}+l_3m_3C_{1,1}+l_4m_4C_{1,2}+l_5m_5C_{1,1}\\
M_{32} &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-l_3m_3S_{1,1}-l_4m_4S_{1,2}-l_5m_5S_{1,1}\\
M_{33} &= 
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
M_{34} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
M_{35} &=
M_{33}\\
M_{36} &=
M_{34}\\
M_{37} &=
M_{33}\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{41} &=
M_{14}\\
M_{42} &=
M_{24}\\
M_{43} &= 
M_{34}\\
M_{44} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2\\
M_{45} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
M_{46} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2\\\\
M_{47} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{51} &=
M_{15}\\
M_{52} &=
M_{25}\\
M_{53} &= 
M_{35}\\
M_{54} &=
M_{45}\\
M_{55} &=
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
M_{56} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
M_{57} &=
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{61} &=
M_{16}\\
M_{62} &=
M_{26}\\
M_{63} &= 
M_{36}\\
M_{64} &=
M_{46}\\
M_{65} &=
M_{56}\\
M_{66} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2\\
M_{67} &=
I_2+I_4+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-l_1l_2m_2C_2-l_1l_3m_3C_1+l_1l_4m_4C_2+l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
M_{71} &=
M_{17}\\
M_{72} &=
M_{27}\\
M_{73} &= 
M_{37}\\
M_{74} &=
M_{47}\\
M_{75} &=
M_{57}\\
M_{76} &=
M_{67}\\
M_{77} &=
I_1+I_2+4I_3+I_4+4I_5+m_2l_1^2+m_3l_1^2+m_4l_1^2+m_5l_1^2+m_2l_2^2+m_3l_3^2+m_4l_4^2+m_5l_5^2-2l_1l_2m_2C_2-2l_1l_3m_3C_1+2l_1l_4m_4C_2+2l_1l_5m_5C_1\\
\end{aligned}
\right.
$$

$$
\left\{
\begin{aligned}
G_1 &=0\\
G_2 &=
m_1+m_2+m_3+m_4+m_5\\
G_3 &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-2l_3m_3S_{1,1}-l_4m_4S_{1,2}-2l_5m_5S_{1,1}\\
G_4 &=
-l_2m_2S_{1,2}-l_4m_4S_{1,2}\\
G_5 &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-2l_3m_3S_{1,1}-l_4m_4S_{1,2}-2l_5m_5S_{1,1}\\
G_6 &=
-l_2m_2S_{1,2}-l_4m_4S_{1,2}\\
G_7 &=
l_1m_2S_1+l_1m_3S_1-l_1m_4S_1-l_1m_5S_1-l_2m_2S_{1,2}-2l_3m_3S_{1,1}-l_4m_4S_{1,2}-2l_5m_5S_{1,1}\\
\end{aligned}
\right.
$$

##### 角动量计算方法

![antcal](https://s2.loli.net/2022/06/16/vEDaFkB2iTM6t5o.png)

<img src="https://s2.loli.net/2022/06/16/Lqc5WsfjkMUunpX.png" alt="antcal1" style="zoom: 67%;" />

<img src="https://s2.loli.net/2022/06/16/1tuCZpSUMNHyi89.png" alt="antcal2" style="zoom:67%;" />

<img src="https://s2.loli.net/2022/06/16/eKPbGTodmrA6a4c.png" alt="antcal3" style="zoom:67%;" />

- 二连杆角动量计算验证

  <img src="https://s2.loli.net/2022/06/21/bDZYFnHgAt2BkWL.png" alt="而来杠杆" style="zoom:67%;" />

  1. 二连杆运动学方程
     $$
     \left\{
     \begin{aligned}
     x_1 &= l_{c1}C_1 = \frac{1}{2}l_1C_1 \\
     y_1 &= l_{c1}S_1 = \frac{1}{2}l_1S_1\\
     x_2 &= l_1C_1+l_{c2}C_{1,2} = l_1C_1+\frac{1}{2}l_2C_{1,2} \\
     y_2 &= l_1S_1+l_{c2}S_{1,2} = l_1S_1+\frac{1}{2}l_2S_{1,2} \\
     \end{aligned}
     \right. \qquad \qquad \qquad
     \left\{
     \begin{aligned}
     \dot{x}_1 &= -l_{c1}S_1\dot{\theta}_1 = -\frac{1}{2}l_1S_1\dot{\theta}_1 \\
     \dot{y}_1 &= l_{c1}C_1\dot{\theta}_1 = \frac{1}{2}l_1C_1\dot{\theta}_1\\
     \dot{x}_2 &= -l_1S_1\dot{\theta}_1-l_{c2}S_{1,2}(\dot{\theta}_1+\dot{\theta}_2) = -l_1S_1\dot{\theta}_1-\frac{1}{2}l_2S_{1,2}(\dot{\theta}_1+\dot{\theta}_2)  \\
     \dot{y}_2 &= l_1C_1\dot{\theta}_1+l_{c2}C_{1,2}(\dot{\theta}_1+\dot{\theta}_2)  = l_1C_1\dot{\theta}_1+\frac{1}{2}l_2C_{1,2}(\dot{\theta}_1+\dot{\theta}_2)  \\
     \end{aligned}
     \right.
     $$

  2. 动力学方程
     $$
     \begin{bmatrix}
     M_{11} &M_{12}\\
     M_{21} &M_{22}\\
     \end{bmatrix} + 
     \begin{bmatrix}
     C_{1}\\
     C_{2}\\
     \end{bmatrix} + 
     \begin{bmatrix}
     G_{1}\\
     G_{2}\\
     \end{bmatrix} =
     \begin{bmatrix}
     \tau_{1}\\
     \tau_{2}\\
     \end{bmatrix}
     $$

     $$
     \left\{
     \begin{aligned}
     M_{11} &= m_2l_1^2+\frac{1}{3}m_1l_1^2+\frac{1}{3}m_2l_2^2+m_2l_1l_2C_2 \\
     &=m_1l_{c1}^2+m_2(l_1^2+l_{c2}^2+2l_1l_{c2}C_2)+I_1+I_2\\
     M_{12}&=\frac{1}{3}m_2l_2^2+\frac{1}{2}m_2l_1l_2C_2 \\
     &=m_2(l_{c2}^2+l_1l_{c2}C_2)+I_2\\
     &=M_{21}\\
     M_{22}&=\frac{1}{3}m_2l_2^2\\
     &=m_2l_{c2}^2+I_2\\
     \end{aligned}
     \right.
     $$

     $$
     \left\{
     \begin{aligned}
     C_{1} &= -m_2l_1l_2S_2\dot{\theta}_1\dot{\theta}_2- \frac{1}{2}m_2l_1l_2S_2\dot{\theta}_2^2\\
     &=-2m_2l_1l_{c2}S_2\dot{\theta}_1\dot{\theta}_2-m_2l_1l_{c2}S_2\dot{\theta}_2^2\\
     C_{2}&= \frac{1}{2}m_2l_1l_2S_2\dot{\theta}_1^2\\
     &=m_2l_1l_{c2}S_2\dot{\theta}_1^2\\
     \end{aligned}
     \right.
     $$

     $$
     \left\{
     \begin{aligned}
     G_{1} &= (\frac{1}{2}m_1+m_2)gl_1C_1+\frac{1}{2}m_2gl_2C_{1,2}\\
     &=(m_1l_{c1}+m_2l_1)gC_1+m_2gl_{c2}C_{1,2}\\
     G_{2}&= \frac{1}{2}m_2gl_2C_{1,2}\\
     &=m_2gl_{c2}C_{1,2}\\
     \end{aligned}
     \right.
     $$

  3. 通过求相对于原点的总角动量（即$L = L_1+L_2$)然后对L进行求导便可以得到相对于关节1的动力学方程，即上式的第一行。

#### 人体数据和数据采集设备

##### 人体质量数据

| 部分 | 重量占比 | 长度占比         | 重量（70kg） | 长度（1.75m） |
| ---- | -------- | ---------------- | ------------ | ------------- |
| 躯干 | 43.02%   | 30%              | 30.114       | 0.525         |
| 头劲 | 6.81%    | 10.75%           | 4.767        | 0.188         |
| 上臂 | 2.63%    | 17.25%           | 1.841        | 0.302         |
| 前臂 | 1.5%     | 15.85%+5.75%(手) | 1.05         | 0.277+0.1     |
| 双臂 | 9.43%    |                  | 6.601        |               |
| 大腿 | 14.47%   | 24.05%           | 10.129       | 0.42          |
| 小腿 | 4.57%    | 25.2%+4.25%(足)  | 3.199        | 0.441+0.074   |
| 双腿 | 40.74%   |                  | 28.518       |               |

##### 人体运动速度和步频

| 速度  | Ta (aerial) | Tc (contact) | Stance | T      |
| ----- | ----------- | ------------ | ------ | ------ |
| 3 m/s | 0.12 s      | 0.25 s       | 0.338  | 0.74 s |
| 4 m/s | 0.14 s      | 0.23 s       | 0.31   | 0.74 s |
| 5 m/s | 0.15 s      | 0.19 s       | 0.28   | 0.68 s |
| 6 m/s | 0.15 s      | 0.175 s      | 0.27   | 0.65 s |
| 7 m/s | 0.14 s      | 0.155 s      | 0.263  | 0.59 s |
| 8 m/s | 0.125 s     | 0.135 s      | 0.26   | 0.52 s |
| 9 m/s | 0.105 s     | 0.115 s      | 0.26   | 0.44 s |



- Nummela, Ari，Keränen, T., Mikkelsson, L. O., Factors related to top running speed and economy

  ![tstw1](https://s2.loli.net/2022/07/21/xylLj1UmJAeZ7KM.png)

- Faster top running speeds are achieved with greater ground forces not more rapid leg movements

  <img src="https://s2.loli.net/2022/07/21/KlxjybSzJcDnsiA.png" alt="tstw2"  />

- Ground contact time as an indicator of metabolic cost in elite distance runners

  ![tstw3](https://s2.loli.net/2022/07/21/AULMx4rgfa6DyJd.png)

- The biological limits to running speed are imposed from the ground up

  ![tstw4](https://s2.loli.net/2022/07/21/Dj76xTFkCLKJUcn.png)

- Differences in ground contact time explain the less efficient running economy in North African runners

  ![tstw5](https://s2.loli.net/2022/07/21/BUIb85n9LmVP4ud.png)



##### calc文件中序号和关节对应

| 关节            | 数据序号 |
| --------------- | -------- |
| hips            | 1        |
| right up leg    | 2        |
| right lower leg | 3        |
| right foot      | 4        |
| left up leg     | 5        |
| left lower leg  | 6        |
| left foot       | 7        |
| right shoulder  | 8        |
| right up arm    | 9        |
| right forearm   | 10       |
| right hand      | 11       |
| left shoulder   | 12       |
| left up arm     | 13       |
| left forearm    | 14       |
| left hand       | 15       |
| head            | 16       |
| neck            | 17       |

##### 坐标系定义
1. BVH-Global坐标准则下的世界坐标系及各关节坐标系（局部坐标系由于传感器穿戴会存在差异，并非始终为下图所示）

2. 世界坐标系（x 指向北方， y 指向东方， z 指向下方）

   <img src="https://s2.loli.net/2022/06/16/x8pfkV2D9FQlrg4.png" alt="bvh" style="zoom: 50%;" />

   <img src="https://s2.loli.net/2022/06/08/h5L34fyHFrmWoiS.png" alt="human3D_walk_axis.drawio" style="zoom: 50%;" />	

#### 正常步态下角动量数据化
##### walk步态下基于hip局部坐标的角动量测试

1. 数据结果

   <img src="https://s2.loli.net/2022/06/16/2yJWl7SrRCZduhM.png" alt="hip-ant" style="zoom: 67%;" />

   <img src="https://s2.loli.net/2022/06/16/KyZe3igb1DTzNsH.png" alt="hip-antsum" style="zoom:67%;" />
   
2. 数据结果分析

   问题：

   1. 给予hip局部坐标系的话是非惯性坐标系，当身体相对于惯性坐标系有速度和加速度时，由于矢量相加导致其他部分的速度并非简单的常数相加，涉及到矢量加乘，会导致结果产生差异，因此产生的结果不具有说服力。
   2. 周期内<font color='red'>角动量之和有什么意义</font>？<font color='DeepSkyBlue' size='6'>(>_<)有点自己的想法，OK？不要别人说什么你就做什么！！！</font>

##### walk步态下相对于支撑脚（惯性系下）坐标系的角动量测试

- 基于支撑脚局部坐标初步测试（相对于世界坐标系矢量加减），因此由于运动朝向和世界坐标系下的xy方向不同，因此该测试下只有绕z轴方向的角动量有参考意义，结果如下

  <img src="https://s2.loli.net/2022/06/16/hQodRXTs1kNqOvP.png" alt="ant" style="zoom:67%;" />

  <img src="https://s2.loli.net/2022/06/16/FkHKUawDSBhWRsv.png" alt="antsum" style="zoom: 50%;" />

  1. 结果数据分析



- walk步态下手臂摆动和束缚时的运动对比

  - **手臂摆动**：yuan-左脚为支撑点)

  ![antwalkarm2 - 副本](https://s2.loli.net/2022/06/17/PAWLu54wEzejM8a.png)

  - **手臂束缚**(yuan-左脚为支撑点)

    ![antwalknoarmL2-2](https://s2.loli.net/2022/06/20/mNoX8iFTK3pxhEk.png)
    

  

  - **手臂摆动/束缚对比**(liu-左脚为支撑点)

    <img src="https://s2.loli.net/2022/06/28/GFAOpK6sSVfY9qR.png" alt="walk-liu-ppt" style="zoom: 67%;" />

  1. 力/加速度对比

     **手臂摆动**：左脚为支撑点)

     <img src="https://s2.loli.net/2022/06/20/NuXYJiUH6Kxnsj4.png" alt="force-arm" style="zoom: 67%;" />

     **手臂束缚**：左脚为支撑点)

     <img src="https://s2.loli.net/2022/06/20/LNl2xYoq46keST7.png" alt="force-noarm" style="zoom:67%;" />

  - 结果分析
    1. 手臂摆动时，<font color='red'>手臂的角动量方向与身体的角动量方向相同，与腿的相反</font>，这就意味着，<font color='red'>身体和手臂的运动作用可以抵消腿部运动产生的角动量</font>，维持身体平衡。
    2. 测试刘哥和我，伟哥的运动时发现，<font color = 'red'>手臂的摆动角动量幅值基本维持在1左右，腿部角动量有较大的差距</font>。
    3. 好奇一点：<font color='DeepSkyBlue'>为什么右腿和左腿的角动量方向不同?</font>
    4. 手臂束缚时，<font color = 'red'>身体的角动量几乎为零，意味着手臂不摆动时，没有额外角动量可以抵消腿部产生的角动量</font>。但是身体的角动量变化幅值很小，直观理解，即使身体和手臂不懂，也能正常走，所以很可能在walk工况下手臂角动量的影响并不明显
    5. 另外一点：直觉不应该是束缚时躯干的角动量和腿的相反，臂不束缚更大？



#### 站立稳定恢复测试

##### **站立扰动后成功稳定恢复**

  1. 手臂摆动

  <img src="https://s2.loli.net/2022/06/24/uewjiM86V7J2QAC.png" alt="bal4" style="zoom: 80%;" />

  2. 手臂束缚

     <img src="https://s2.loli.net/2022/06/25/VomMD1FKyQGswcz.png" alt="noarm-bal" style="zoom:67%;" />
     
  3. 手臂束缚/摆动对比图

     <img src="https://s2.loli.net/2022/06/28/cs48YmvObf7n1oa.png" alt="balvs" style="zoom:67%;" />

  4. 结果分析：

     - 在扰动时，<font color = 'red'>手臂的角动量始终与躯干的角动量相反，幅值相当</font>，抵消由于初始扰动身体偏置导致产生的身体角动量。

     - 手臂摆动时，可以发现尽管存在着一定的相位差，但手臂的摆动角动量趋势是<font color = 'red'>尽可能完全抵消身体的角动量</font>，因此可以推测在稳定恢复时，<font color = 'red'>手臂的作用是使得身体的总的角动量为零</font>，这样可以降低关节和足底恢复身体需要的力，即满足：。
       $$
       L_{arm}+L_{leg}+L_{trunk}=0
       $$
       

##### **站立扰动稳定恢复失败**

  1. 手臂摆动
  
     ![failed_arm](https://s2.loli.net/2022/06/25/muTCUHDNk5F8s1y.png)
  
  2. 手臂束缚
     ![failed_no_arm](https://s2.loli.net/2022/06/25/16bDqlUVdyajINg.png)
     
  3. 手臂束缚/摆动对比图
  
     <img src="https://s2.loli.net/2022/06/28/oxsUIE8baX7frg9.png" alt="balfail" style="zoom:67%;" />

- 结果分析

  1. 站立稳定恢复时，<font color = 'red'>x，y方向手臂的角动量与身体相反，且手臂幅值与腿加躯干的相当</font>，因此由于初始扰动和重力作用产生的角动量可以通过手臂的挥动来抵消，这样可以减少腿部和腰部来帮助身体恢复平衡时需要的能量消耗。
  2. 对于成功稳定恢复工况，手臂摆动与束缚情况相比，<font color = 'red'>摆动时稳定恢复的时间更长，但是角动量幅值更小</font>，这样腰部和腿部控制身体平衡时需要消耗的能量和作用力就更小。
  3. 对于无法站立稳定恢复，需要迈出一步来平衡身体的工况下，<font color = 'red'>一方面手臂摆动可以增加恢复时间</font>，给于下肢和腰部更多的反应时间迈腿和作用，<font color = 'red'>同时摆臂是躯干的角动量幅值更小</font>。
  

#### 站立稳定恢复中的动能数据分析

- 手臂摆动![能量-arm](https://s2.loli.net/2022/06/28/MSIpHGkUln67JDe.png)：liu

  

- 手臂束缚：liu

  ![能量](https://s2.loli.net/2022/06/28/cUXm823WDGjoiRz.png)

- 结果分析

  1. 分析束缚和摆臂时的动能数据，除了束缚时身体的动能更大，手臂的动能更小，并未发现其他更显著的规律。

#### 角动量假设工作总结

##### **从角动量角度出发，分析身体受扰动后的手臂摆动的作用机理**

- <font color = 'red'>手臂的角动量与躯干相反，幅值接近</font>，抵消由于初始扰动导致产生的身体角动量。
- <font color = 'red'>手臂摆动和束缚相比，躯干的角动量幅值更小</font>
- 对于无法站立稳定恢复，<font color = 'red'>手臂摆动可以增加恢复时间，同时摆臂时躯干的角动量幅值更小</font>

##### 手臂摆动在身体受扰动稳定恢复过程的全局作用

$$
L_{arm}+L_{leg}+L_{trunk}=0
$$

- 通过该公式，在角动量最大和最小是带入轨迹人体运动数据结合机器人参数可以得到<font color = 'red'>手臂质量的初始优化范围</font>。

#### 基于人体数据采集角动量分析工作的问题

- 臂的摆动在不同实验对象不同工况下的存在差异，难以进行统一的解释。
- 采集到的数据缺少如足底力和力矩信息，难以进行完整的动力学分析。





### 机械臂参数优化的方法和计划

#### 方法

- 计算人体二维简化模型运动轨迹，基于完整数据进行人体运动的动力学分析。



#### 目标和预期结果

- 对扰动平衡恢复，臂摆动和束缚下身体关节力矩和足底力的影响（<font color = 'red'>手臂摆动可以降低关节力矩和足底力</font>）。

- 做出不同手臂<font color = 'red'>质量、惯量参数下关节力矩、足底力、功率等参数的分布图</font>（之后根据关节力矩等需求选择质量惯量参数）。

  

#### 人体九连杆简化模型

<img src="https://s2.loli.net/2022/07/01/xhMcLmfZzCr8lAw.png" alt="human2D.drawio" style="zoom:67%;" />

##### 运动学方程

$$
\left\{
\begin{aligned}
x_0 &= x_r+l_0S_0\\
z_0 &= z_r-l_0C_0\\
x_1 &= x_r+L_0S_0+l_1S_{0,1}\\
z_1 &= z_r-L_0C_0-l_1C_{0,1}\\
x_2 &= x_r+L_0S_0+L_1S_{0,1}+l_2S_{0,1,2}\\
z_2 &= z_r-L_0C_0-L_1C_{0,1}-l_2C_{0,1,2}\\
x_3 &= x_r+L_0S_0+l_1S_{0,3}\\
z_3 &= z_r-L_0C_0-l_1C_{0,3}\\
x_4 &= x_r+L_0S_0+L_1S_{0,3}+l_2S_{0,3,4}\\
z_4 &= z_r-L_0C_0-L_1C_{0,3}-l_2C_{0,3,4}\\
x_5 &= x_r+l_3S_{0,5}\\
z_5 &= z_r-l_3C_{0,5}\\
x_6 &= x_r+L_3S_{0,5}+l_4S_{0,5,6}\\
z_6 &= z_r-L_3C_{0,5}-l_4C_{0,5,6}\\
x_7 &= x_r+l_3S_{0,7}\\
z_7 &= z_r-l_3C_{0,7}\\
x_8 &= x_r+L_3S_{0,7}+l_4S_{0,7,8}\\
z_8 &= z_r-L_3C_{0,7}-l_4C_{0,7,8}\\
\end{aligned}
\right.
$$



##### 全神动力学方程

$$
\begin{bmatrix}
\mathrm{M}_{b,b} &\mathrm{M}_{b,lg} &\mathrm{M}_{b,rg} &\mathrm{M}_{b,la} &\mathrm{M}_{b,ra}\\
\mathrm{M}^T_{b,lg} &\mathrm{M}_{lg,lg} &\mathrm{0} &\mathrm{0} &\mathrm{0}\\
\mathrm{M}^T_{b,rg} &\mathrm{0} &\mathrm{M}_{rg,rg} &\mathrm{0} &\mathrm{0}\\
\mathrm{M}^T_{b,la} &\mathrm{0} &\mathrm{0} &\mathrm{M}_{la,la} &\mathrm{0}\\
\mathrm{M}^T_{b,ra} &\mathrm{0} &\mathrm{0} &\mathrm{0} &\mathrm{M}_{ra,ra}\\
\end{bmatrix}
\begin{bmatrix}
\ddot{x}\\
\ddot{y}\\
\ddot{\theta}_{lg1}\\
\ddot{\theta}_{lg2}\\
\ddot{\theta}_{rg1}\\
\ddot{\theta}_{rg2}\\
\ddot{\theta}_{la1}\\
\ddot{\theta}_{la2}\\
\ddot{\theta}_{ra1}\\
\ddot{\theta}_{ra2}\\
\end{bmatrix}
+
\begin{bmatrix}
\mathrm{G}_{b}\\
\mathrm{G}_{lg}\\
\mathrm{G}_{rg}\\
\mathrm{G}_{la}\\
\mathrm{G}_{ra}\\
\end{bmatrix}g
+
\begin{bmatrix}
\mathrm{C}_b\\
\mathrm{C}_{lg}\\
\mathrm{C}_{rg}\\
\mathrm{C}_{la}\\
\mathrm{C}_{ra}\\
\end{bmatrix}
=
\begin{bmatrix}
0 \\ 0 \\ \tau_{b} \\ \tau_{lg1} \\ \tau_{lg2} \\ \tau_{rg1} \\ \tau_{rg2} \\ 
\tau_{la1} \\ \tau_{la2}\\ \tau_{ra1} \\ \tau_{ra2}
\end{bmatrix}
+
\begin{bmatrix}
\mathrm{J}_l &\mathrm{J}_r
\end{bmatrix}
\begin{bmatrix}
F_{lx} \\ F_{ly} \\ F_{rx} \\ F_{ry}
\end{bmatrix}
$$

- 惯量项

$$
\begin{aligned}
&m_{xs\theta}=2L_0C_0(m_1+m_2)+m_0l_0C_0+\displaystyle\sum_{k=lg,rg,la,ra}
(m_{k2}L_{k1}C_{0,k1}+m_{k1}l_{k1}C_{0,k1}+m_{k2}L_{k2}C_{0,k1,k2})\\
&m_{x\theta\theta}=\hat{I}_{0,1,2,1,2,3,4,3,4}+2L_0^2(m_1+m_2)+2L_1^2m_2+2L_3^2m_4+\\
&2L_0L_1m_2(C_1+C_3)+2L_0l_1m_1(C_1+C_3)+2L_0l_2m_2(C_{1,2}+C_{3,4})+2L_1l_2m_2(C_2+C_4)+2L_3l_4m_4(C_6+C_8)\\
\\
&\mathrm{M}_{b,b} =
\begin{bmatrix}
m_{0,1,2,1,2,3,4,3,4} &0 &m_{xc\theta}\\
0 &m_{0,1,2,1,2,3,4,3,4} &m_{xs\theta}\\
m_{xc\theta} &m_{xs\theta} &m_{x\theta\theta}\\
\end{bmatrix}\\
\\
&\mathrm{M}_{b,lg} =
\begin{bmatrix}
m_2L_1C_{0,lg1}+m_1l_1C_{0,lg1}+m_2l_2C_{0,lg1,lg2} &m_2l_2C_{0,lg1,lg2}\\
m_2L_1S_{0,lg1}+m_1l_1S_{0,lg1}+m_2l_2S_{0,lg1,lg2} &m_2l_2S_{0,lg1,lg2}\\
\hat{I}_1+\hat{I}_2+L_1^2m_2+L_0L_1m_2C_{lg1}+L_0l_1m_1C_{lg1}+L_0l_2m_2C_{lg1,lg2}+2L_1l_2m_2C_{lg2}
&\quad\hat{I}_2+L_0l_2m_2C_{lg1,lg2}+L_1l_2m_2C_{lg2}
\end{bmatrix} \\
\\
&\mathrm{M}_{b,rg} =
\begin{bmatrix}
m_2L_1C_{0,rg1}+m_1l_1C_{0,rg1}+m_2l_2C_{0,rg1,rg2} &m_2l_2C_{0,rg1,rg2}\\
m_2L_1S_{0,rg1}+m_1l_1S_{0,rg1}+m_2l_2S_{0,rg1,rg2} &m_2l_2S_{0,rg1,rg2}\\
\hat{I}_1+\hat{I}_2+L_1^2m_2+L_0L_1m_2C_{rg1}+L_0l_1m_1C_{rg1}+L_0l_2m_2C_{rg1,rg2}+2L_1l_2m_2C_{rg2}
&\hat{I}_2+L_0l_2m_2C_{rg1,rg2}+L_1l_2m_2C_{rg2}
\end{bmatrix}\\
\\
&\mathrm{M}_{b,la} =
\begin{bmatrix}
m_4L_3C_{0,la1}+m_3l_3C_{0,la1}+m_4l_4C_{0,la1,la2} &m_4l_4C_{0,la1,la2}\\
m_4L_3S_{0,la1}+m_3l_3S_{0,la1}+m_4l_4S_{0,la1,la2} &m_4l_4S_{0,la1,la2}\\
\hat{I}_3+\hat{I}_4+L_3^2m_4+2L_3l_4m_4C_{la2}
&\hat{I}_4+L_3l_4m_4C_{la2}
\end{bmatrix} \\
\\
&\mathrm{M}_{b,ra} =
\begin{bmatrix}
m_4L_3C_{0,ra1}+m_3l_3C_{0,ra1}+m_4l_4C_{0,ra1,ra2} &m_4l_4C_{0,ra1,ra2}\\
m_4L_3S_{0,ra1}+m_3l_3S_{0,ra1}+m_4l_4S_{0,ra1,ra2} &m_4l_4S_{0,ra1,ra2}\\
\hat{I}_3+\hat{I}_4+L_3^2m_4+2L_3l_4m_4C_{ra2}
&\hat{I}_4+L_3l_4m_4C_{ra2}
\end{bmatrix}\\
\\
&\mathrm{M}_{lg,lg}=
\begin{bmatrix}
\hat{I}_1+\hat{I}_2+m_2L^2_1+2m_2l_{2}L_1C_{lg2} &\hat{I}_2+m_2l_{2}L_1C_{lg2}\\
\hat{I}_2+m_2l_{2}L_1C_{lg2} &\hat{I}_2
\end{bmatrix}\\
\\
&\mathrm{M}_{rg,rg}=
\begin{bmatrix}
\hat{I}_1+\hat{I}_2+m_2L^2_1+2m_2l_{2}L_1C_{rg2} &\hat{I}_2+m_2l_{2}L_1C_{rg2}\\
\hat{I}_2+m_2l_{2}L_1C_{rg2} &\hat{I}_2
\end{bmatrix}\\
\\
&\mathrm{M}_{la,la}=
\begin{bmatrix}
\hat{I}_3+\hat{I}_4+m_4L^2_3+2m_4L_3l_4C_{la2} &\hat{I}_4+m_4L_3l_4C_{la2}\\
\hat{I}_4+m_4L_3l_4C_{la2} &\hat{I}_4
\end{bmatrix}\\
\\
&\mathrm{M}_{ra,ra}=
\begin{bmatrix}
\hat{I}_3+\hat{I}_4+m_4L^2_3+2m_4L_3l_4C_{ra2} &\hat{I}_4+m_4L_3l_4C_{ra2}\\
\hat{I}_4+m_4L_3l_4C_{ra2} &\hat{I}_4
\end{bmatrix}

\end{aligned}
$$

- 重力项

$$
\begin{aligned}
&\mathrm{G}_b =
\begin{bmatrix}
0 \\ m_{0,1,2,1,2,3,4,3,4}\\
2L_0S_0(m_1m_2)+m_0l_0S_0+\displaystyle\sum_{k=lg,rg,la,ra}(L_{k1}m_{k2}C_{0,k1}+l_{k1}m_{k1}S_{0,k1}+l_{k2}m_{k2}S_{0,k1,k2})
\end{bmatrix}\\
\\
&\mathrm{G}_{lg} =
\begin{bmatrix}
(m_2L_1+m_1l_1)S_{0,lg1}+m_2l_2S_{0,lg1,lg2} \\
m_2l_2S_{0,lg1,lg2}
\end{bmatrix}\\
\\
&\mathrm{G}_{rg} =
\begin{bmatrix}
(m_2L_1+m_1l_1)S_{0,rg1}+m_2l_2S_{0,rg1,rg2} \\
m_2l_2S_{0,rg1,rg2}
\end{bmatrix}\\
\\
&\mathrm{G}_{la} =
\begin{bmatrix}
(m_4L_3+m_3l_3)S_{0,la1}+m_4l_4S_{0,la1,la2} \\
m_4l_4S_{0,la1,la2}
\end{bmatrix}\\
\\
&\mathrm{G}_{ra} =
\begin{bmatrix}
(m_4L_3+m_3l_3)S_{0,ra1}+m_4l_4S_{0,ra1,ra2} \\
m_4l_4S_{0,ra1,ra2}
\end{bmatrix}
\end{aligned}
$$

- 离心力项

$$
\begin{aligned}
&m_{bs\theta} = 2L_0S_0(m_1+m_2)+m_0l_0S_0+\displaystyle\sum_{k=lg,rg,la,ra}(L_{k1}m_{k2}S_{0,k1}+l_{k1}m_{k1}S_{0,k1}+l_{k2}m_{k2}S_{0,k1,k2})\\
\\
&m_{odd,s\theta}=L_{k1}m_{k2}S_{0,k1}+l_{k1}m_{k1}S_{0,k1}+l_{k2}m_{k2}S_{0,k1,k2}\\
\\
&m_{eve,s\theta}=l_{k2}m_{k2}S_{0,k1,k2}\\
\\
&m_{s\theta\theta1}=L_0(L_{k1}m_{k2}S_{k1}+l_{k1}m_{k1}S_{k1}+l_{k2}m_{k2}S_{k1,k2})\\
\\
&m_{s\theta\theta2}=m_{k2}l_{k2}(L_0S_{k1,k2}+L_{k1}S_{k2})\\
\\
&m_{s\theta\theta3}=m_{k2}l_{k2}L_{k1}S_{k2}\\
\\
&\mathrm{C}_b=
\begin{bmatrix}
-(m_{bs\theta})\dot{\theta}_0^2-
\displaystyle\sum_{k=...}(2m_{odd,s\theta}\dot{\theta}_0\dot{\theta}_{k1}+2m_{eve,s\theta}\dot{\theta}_0\dot{\theta}_{k2}+
m_{odd,s\theta}\dot{\theta}_{k1}^2+m_{eve,s\theta}\dot{\theta}_{k2}^2+2m_{odd,s\theta}\dot{\theta}_{k1}\dot{\theta}_{k2})\\
(m_{bc\theta})\dot{\theta}_0^2+
\displaystyle\sum_{k=...}(2m_{odd,c\theta}\dot{\theta}_0\dot{\theta}_{k1}+2m_{eve,c\theta}\dot{\theta}_0\dot{\theta}_{k2}+
m_{odd,c\theta}\dot{\theta}_{k1}^2+m_{eve,c\theta}\dot{\theta}_{k2}^2+2m_{odd,c\theta}\dot{\theta}_{k1}\dot{\theta}_{k2})\\
-\displaystyle\sum_{k=lg,rg}(2m_{s\theta\theta1}\dot{\theta}_0\dot{\theta}_{k1}+2m_{s\theta\theta2}\dot{\theta}_0\dot{\theta}_{k2}+m_{s\theta\theta1}\dot{\theta}_{k1}^2+m_{s\theta\theta2}\dot{\theta}_{k2}^2+2m_{s\theta\theta2}\dot{\theta}_{k1}\dot{\theta}_{k2})-\displaystyle\sum_{k=la,ra}(2m_{s\theta\theta3}\dot{\theta}_0\dot{\theta}_{k2}+2m_{s\theta\theta3}\dot{\theta}_{k1}\dot{\theta}_{k2}+m_{s\theta\theta3}\dot{\theta}_{k2}^2)
\end{bmatrix}\\
\\
&\mathrm{C}_{lg}=
\begin{bmatrix}
m_{s\theta\theta1,lg}\dot{\theta}_0^2-2m_{s\theta\theta3,lg}\dot{\theta}_0\dot{\theta}_{k2,lg}-2m_{s\theta\theta3,lg}\dot{\theta}_{k1,lg}\dot{\theta}_{k2,lg}-m_{s\theta\theta3,lg}\dot{\theta}_{k2,lg}^2\\
m_{s\theta\theta2,lg}\dot{\theta}_0^2+2m_{s\theta\theta3,lg}\dot{\theta}_0\dot{\theta}_{k1,lg}+m_{s\theta\theta3,lg}\dot{\theta}_{k1,lg}^2
\end{bmatrix}\\
\\
&\mathrm{C}_{rg}=
\begin{bmatrix}
m_{s\theta\theta1,rg}\dot{\theta}_0^2-2m_{s\theta\theta3,rg}\dot{\theta}_0\dot{\theta}_{k2,rg}-2m_{s\theta\theta3,rg}\dot{\theta}_{k1,rg}\dot{\theta}_{k2,rg}-m_{s\theta\theta3,rg}\dot{\theta}_{k2,rg}^2\\
m_{s\theta\theta2,rg}\dot{\theta}_0^2+2m_{s\theta\theta3,rg}\dot{\theta}_0\dot{\theta}_{k1,rg}+m_{s\theta\theta3,rg}\dot{\theta}_{k1,rg}^2
\end{bmatrix}\\
\\
&\mathrm{C}_{la}=
\begin{bmatrix}
-2m_{s\theta\theta3,la}\dot{\theta}_0\dot{\theta}_{k2,la}-2m_{s\theta\theta3,la}\dot{\theta}_{k1,la}\dot{\theta}_{k2,la}-m_{s\theta\theta3,la}\dot{\theta}_{k2,la}^2\\
m_{s\theta\theta2,la}\dot{\theta}_0^2+2m_{s\theta\theta3,la}\dot{\theta}_0\dot{\theta}_{k1,la}+m_{s\theta\theta3,la}\dot{\theta}_{k1,la}^2
\end{bmatrix}\\
\\
&\mathrm{C}_{ra}=
\begin{bmatrix}
-2m_{s\theta\theta3,ra}\dot{\theta}_0\dot{\theta}_{k2,ra}-2m_{s\theta\theta3,rg}\dot{\theta}_{k1,ra}\dot{\theta}_{k2,ra}-m_{s\theta\theta3,ra}\dot{\theta}_{k2,ra}^2\\
m_{s\theta\theta2,la}\dot{\theta}_0^2+2m_{s\theta\theta3,la}\dot{\theta}_0\dot{\theta}_{k1,la}+m_{s\theta\theta3,la}\dot{\theta}_{k1,la}^2
\end{bmatrix}\\
\end{aligned}
$$

- 接触矩阵
  $$
  \begin{aligned}
  &\mathrm{J}_l=\begin{bmatrix}
  1 &0\\
  0 &1\\
  L_1C_{l1}+L_2C_{l1,l2} &L_1S_{l1}+L_2S_{l1,l2}\\
  L_2C_{l1,l2} &L_2S_{l1,l2}\\
  0 &0\\ 0 &0
  \end{bmatrix}\\
  &\mathrm{J}_r=\begin{bmatrix}
  1 &0\\
  0 &1\\
  0 &0\\
  0 &0\\
  L_1C_{r1}+L_2C_{r1,r2} &L_1S_{r1}+L_2S_{r1,r2}\\
  L_2C_{r1,r2} &L_2S_{r1,r2}\\
  \end{bmatrix}\\
  \end{aligned}
  $$
  

##### 半神动力学方程1

- **x0,z0 in hip and $$\theta_{hhip} = \theta_{hip}$$**

$$
\begin{bmatrix}
\mathrm{M}_{b,b} &\mathrm{M}_{b,lg} &\mathrm{M}_{b,la}\\
\mathrm{M}^T_{b,lg} &\mathrm{M}_{lg,lg} &\mathrm{0}\\
\mathrm{M}^T_{b,la} &\mathrm{0} &\mathrm{M}_{la,la}\\
\end{bmatrix}
\begin{bmatrix}
\ddot{x}\\
\ddot{y}\\
\ddot{\theta}_{lg1}\\
\ddot{\theta}_{lg2}\\
\ddot{\theta}_{la1}\\
\ddot{\theta}_{la2}\\
\end{bmatrix}
+
\begin{bmatrix}
\mathrm{G}_{b}\\
\mathrm{G}_{lg}\\
\mathrm{G}_{la}\\
\end{bmatrix}g
+
\begin{bmatrix}
\mathrm{C}_b\\
\mathrm{C}_{lg}\\
\mathrm{C}_{la}\\
\end{bmatrix}
=
\begin{bmatrix}
0 \\ 0 \\ \tau_{b} \\ \tau_{lg1} \\ \tau_{lg2} \\ 
\tau_{la1} \\ \tau_{la2}\\
\end{bmatrix}
+
\begin{bmatrix}
\mathrm{J}_l &\mathrm{J}_r
\end{bmatrix}
\begin{bmatrix}
F_{lx} \\ F_{ly}
\end{bmatrix}
$$

- 惯量项

$$
\begin{aligned}
&m_{xc\theta}=-L_0C_0(m_3+m_4)-m_0l_0C_0+\displaystyle\sum_{k=la}
(m_{k2}L_{k1}C_{0,k1}+m_{k1}l_{k1}C_{0,k1}+m_{k2}l_{k2}C_{0,k1,k2})\\
&m_{xs\theta}=-L_0S_0(m_1+m_2)-m_0l_0S_0+\displaystyle\sum_{k=la}
(m_{k2}L_{k1}S_{0,k1}+m_{k1}l_{k1}S_{0,k1}+m_{k2}l_{k2}S_{0,k1,k2})\\
&m_{x\theta\theta}=\hat{I}_{0,3,4}+L_0^2(m_3+m_4)+L_3^2m_4-\\
&2L_0L_3m_4C_3-2L_0l_3m_3C_3+2L_0l_4m_4C_{3,4}+2L_3l_4m_4C_4\\
\\
&\mathrm{M}_{b,b} =
\begin{bmatrix}
m_{0,1,2,3,4} &0 &m_{xc\theta}\\
0 &m_{0,1,2,3,4} &m_{xs\theta}\\
m_{xc\theta} &m_{xs\theta} &m_{x\theta\theta}\\
\end{bmatrix}\\
\\
&\mathrm{M}_{b,lg} =
\begin{bmatrix}
m_2L_1C_{lg1}+m_1l_1C_{lg1}+m_2l_2C_{lg1,lg2} &m_2l_2C_{lg1,lg2}\\
m_2L_1S_{lg1}+m_1l_1S_{lg1}+m_2l_2S_{lg1,lg2} &m_2l_2S_{lg1,lg2}\\
0 &0
\end{bmatrix} \\
\\

&\mathrm{M}_{b,la} =
\begin{bmatrix}
m_4L_3C_{0,la1}+m_3l_3C_{0,la1}+m_4l_4C_{0,la1,la2} &m_4l_4C_{0,la1,la2}\\
m_4L_3S_{0,la1}+m_3l_3S_{0,la1}+m_4l_4S_{0,la1,la2} &m_4l_4S_{0,la1,la2}\\
\hat{I}_3+\hat{I}_4+L_3^2m_4+2L_3l_4m_4C_{la2}-L_0L_3m_4C_{la1}-L_0l_3m_3C_{la1}-L_0l_4m_4C_{la1,la2}
&\hat{I}_4+L_3l_4m_4C_{la2}-L_0l_4m_4C_{la1,la2}
\end{bmatrix} \\
\\

&\mathrm{M}_{lg,lg}=
\begin{bmatrix}
\hat{I}_1+\hat{I}_2+m_2L^2_1+2m_2l_{2}L_1C_{lg2} &\hat{I}_2+m_2l_{2}L_1C_{lg2}\\
\hat{I}_2+m_2l_{2}L_1C_{lg2} &\hat{I}_2
\end{bmatrix}\\
\\

&\mathrm{M}_{la,la}=
\begin{bmatrix}
\hat{I}_3+\hat{I}_4+m_4L^2_3+2m_4L_3l_4C_{la2} &\hat{I}_4+m_4L_3l_4C_{la2}\\
\hat{I}_4+m_4L_3l_4C_{la2} &\hat{I}_4
\end{bmatrix}\\
\\

\end{aligned}
$$

- 重力项

$$
\begin{aligned}
&\mathrm{G}_b =
\begin{bmatrix}
0 \\ m_{0,1,2,3,4}\\
m_{xs\theta}
\end{bmatrix}\\
\\
&\mathrm{G}_{lg} =
\begin{bmatrix}
(m_2L_1+m_1l_1)S_{lg1}+m_2l_2S_{lg1,lg2} \\
m_2l_2S_{lg1,lg2}
\end{bmatrix}\\
\\
&\mathrm{G}_{la} =
\begin{bmatrix}
(m_4L_3+m_3l_3)S_{0,la1}+m_4l_4S_{0,la1,la2} \\
m_4l_4S_{0,la1,la2}
\end{bmatrix}\\

\end{aligned}
$$

- 离心力项

$$
\begin{aligned}
&m_{bs\theta} = L_0S_0(m_3+m_4)+m_0l_0S_0-\displaystyle\sum_{k=la}(L_{k1}m_{k2}S_{0,k1}+l_{k1}m_{k1}S_{0,k1}+l_{k2}m_{k2}S_{0,k1,k2})\\
\\
&m_{odd,s\theta}=L_{k1}m_{k2}S_{0,k1}+l_{k1}m_{k1}S_{0,k1}+l_{k2}m_{k2}S_{0,k1,k2}\\
\\
&m_{odd,sg\theta}=L_{k1}m_{k2}S_{k1}+l_{k1}m_{k1}S_{k1}+l_{k2}m_{k2}S_{k1,k2}\\
\\
&m_{eve,s\theta}=l_{k2}m_{k2}S_{0,k1,k2}\\
\\
&m_{eve,sg\theta}=l_{k2}m_{k2}S_{k1,k2}\\
\\
&m_{s\theta\theta1}=L_0(L_{k1}m_{k2}S_{k1}+l_{k1}m_{k1}S_{k1}+l_{k2}m_{k2}S_{k1,k2})\\
\\
&m_{s\theta\theta2}=m_{k2}l_{k2}(L_0S_{k1,k2}-L_{k1}S_{k2})\\
\\
&m_{s\theta\theta3}=m_{k2}l_{k2}L_{k1}S_{k2}\\
\\
&\mathrm{C}_b=
\begin{bmatrix}
(m_{bs\theta})\dot{\theta}_0^2-
\displaystyle\sum_{k=la}(2m_{odd,s\theta}\dot{\theta}_0\dot{\theta}_{k1}+2m_{eve,s\theta}\dot{\theta}_0\dot{\theta}_{k2}+
m_{odd,s\theta}\dot{\theta}_{k1}^2+m_{eve,s\theta}\dot{\theta}_{k2}^2+2m_{odd,s\theta}\dot{\theta}_{k1}\dot{\theta}_{k2})-\displaystyle\sum_{k=lg}(m_{odd,sg\theta}\dot{\theta}_{k1}^2+2m_{eve,sg\theta}\dot{\theta}_{k1}\dot{\theta}_{k2}+m_{eve,sg\theta}\dot{\theta}_{k2}^2)\\
-(m_{bc\theta})\dot{\theta}_0^2+
\displaystyle\sum_{k=la}(2m_{odd,c\theta}\dot{\theta}_0\dot{\theta}_{k1}+2m_{eve,c\theta}\dot{\theta}_0\dot{\theta}_{k2}+
m_{odd,c\theta}\dot{\theta}_{k1}^2+m_{eve,c\theta}\dot{\theta}_{k2}^2+2m_{odd,c\theta}\dot{\theta}_{k1}\dot{\theta}_{k2})+\displaystyle\sum_{k=lg}(m_{odd,cg\theta}\dot{\theta}_{k1}^2+2m_{eve,cg\theta}\dot{\theta}_{k1}\dot{\theta}_{k2}+m_{eve,cg\theta}\dot{\theta}_{k2}^2)\\
\displaystyle\sum_{k=la}(2m_{s\theta\theta1}\dot{\theta}_0\dot{\theta}_{k1}+2m_{s\theta\theta2}\dot{\theta}_0\dot{\theta}_{k2}+m_{s\theta\theta1}\dot{\theta}_{k1}^2+m_{s\theta\theta2}\dot{\theta}_{k2}^2+2m_{s\theta\theta2}\dot{\theta}_{k1}\dot{\theta}_{k2})
\end{bmatrix}\\
\\
&\mathrm{C}_{lg}=
\begin{bmatrix}
-2m_{s\theta\theta3,lg}\dot{\theta}_{k1,lg}\dot{\theta}_{k2,la}-m_{s\theta\theta3,lg}\dot{\theta}_{k2,lg}^2\\
m_{s\theta\theta3,lg}\dot{\theta}_{k1,lg}^2
\end{bmatrix}\\
\\
&\mathrm{C}_{la}=
\begin{bmatrix}
-m_{s\theta\theta1,la}\dot{\theta}_0^2-2m_{s\theta\theta3,la}\dot{\theta}_0\dot{\theta}_{k2,la}-2m_{s\theta\theta3,la}\dot{\theta}_{k1,la}\dot{\theta}_{k2,la}-m_{s\theta\theta3,la}\dot{\theta}_{k2,la}^2\\
-m_{s\theta\theta2,la}\dot{\theta}_0^2+2m_{s\theta\theta3,la}\dot{\theta}_0\dot{\theta}_{k1,la}+m_{s\theta\theta3,la}\dot{\theta}_{k1,la}^2
\end{bmatrix}\\
\\
\end{aligned}
$$



##### 半神动力学方程2

<img src="https://s2.loli.net/2022/07/12/CtpIMsPK1U7cqiX.png" alt="human2D_walk_bal.drawio" style="zoom:67%;" />

- 运动

- 

- 学
  $$
  \left\{
  \begin{aligned}
  x_0 &= x_r-l_0S_0\\
  z_0 &= z_r+l_0C_0\\
  x_1 &= x_r+l_1S_{0,1}\\
  z_1 &= z_r-l_1C_{0,1}\\
  x_2 &= x_r+L_1S_{0,1}+l_2S_{0,1,2}\\
  z_2 &= z_r-L_1C_{0,1}-l_2C_{0,1,2}\\
  x_3 &= x_r-L_0S_0+l_3S_{0,3}\\
  z_3 &= z_r+L_0C_0-l_3C_{0,3}\\
  x_4 &= x_r-L_0S_0+L_3S_{0,3}+l_4S_{0,3,4}\\
  z_4 &= z_r+L_0C_0-L_3C_{0,3}-l_4C_{0,3,4}\\
  \end{aligned}
  \right.
  
  ​\Rightarrow​
  \left\{\begin{aligned}
  &\dot{x}_{0}= \dot{x}_{r}-l_0C_0\dot{\theta_0}\\
  &\dot{y}_{0}= \dot{y}_{r}-l_0S_0\dot{\theta_0}\\
  &\dot{x}_{1}= \dot{x}_{r}+l_1C_{0,1}\dot{\theta}_{0,1}\\
  &\dot{y}_{1}= \dot{y}_{r}+l_1S_{0,1}\dot{\theta}_{0,1}\\
  &\dot{x}_{2}= \dot{x}_{r}+L_1C_{0,1}\dot{\theta}_{0,1}+l_2C_{0,1,2}\dot{\theta}_{0,1,2}\\
  &\dot{y}_{2}= \dot{y}_{r}+L_1S_{0,1}\dot{\theta}_{0,1}+l_2S_{0,1,2}\dot{\theta}_{0,1,2}\\
  &\dot{x}_{3}= \dot{x}_{r}-L_0C_{0}\dot{\theta}_{0}+l_3C_{0,3}\dot{\theta}_{0,3}\\
  &\dot{y}_{3}= \dot{y}_{r}-L_0S_{0}\dot{\theta}_{0}+l_3S_{0,3}\dot{\theta}_{0,3}\\
  &\dot{x}_{4}= \dot{x}_{r}-L_0C_{0}\dot{\theta}_{0}+L_3C_{0,3}\dot{\theta}_{0,3}+l_4C_{0,3,4}\dot{\theta}_{0,3,4}\\
  &\dot{y}_{4}= \dot{y}_{r}-L_0S_{0}\dot{\theta}_{0}+L_3S_{0,3}\dot{\theta}_{0,3}+l_4S_{0,3,4}\dot{\theta}_{0,3,4}\\
  \end{aligned}
  \right.
  $$
  
- **x0,z0 in hip and $$\theta_{hhip} = \theta_b+\theta_{hip}$$**

$$
\begin{bmatrix}
\mathrm{M}_{b,b} &\mathrm{M}_{b,lg} &\mathrm{M}_{b,la}\\
\mathrm{M}^T_{b,lg} &\mathrm{M}_{lg,lg} &\mathrm{0}\\
\mathrm{M}^T_{b,la} &\mathrm{0} &\mathrm{M}_{la,la}\\
\end{bmatrix}
\begin{bmatrix}
\ddot{x}\\
\ddot{y}\\
\ddot{\theta}_{lg1}\\
\ddot{\theta}_{lg2}\\
\ddot{\theta}_{la1}\\
\ddot{\theta}_{la2}\\
\end{bmatrix}
+
\begin{bmatrix}
\mathrm{G}_{b}\\
\mathrm{G}_{lg}\\
\mathrm{G}_{la}\\
\end{bmatrix}g
+
\begin{bmatrix}
\mathrm{C}_b\\
\mathrm{C}_{lg}\\
\mathrm{C}_{la}\\
\end{bmatrix}
=
\begin{bmatrix}
0 \\ 0 \\ \tau_{b} \\ \tau_{lg1} \\ \tau_{lg2} \\ 
\tau_{la1} \\ \tau_{la2}\\
\end{bmatrix}
+
\begin{bmatrix}
\mathrm{J}_l &\mathrm{J}_r
\end{bmatrix}
\begin{bmatrix}
F_{lx} \\ F_{ly}
\end{bmatrix}
$$

- 惯量项

$$
\begin{aligned}
&m_{xc\theta}=-L_0C_0(m_3+m_4)-m_0l_0C_0+\displaystyle\sum_{k=lg,la}
(m_{k2}L_{k1}C_{0,k1}+m_{k1}l_{k1}C_{0,k1}+m_{k2}l_{k2}C_{0,k1,k2})\\
&m_{xs\theta}=-L_0S_0(m_1+m_2)-m_0l_0S_0+\displaystyle\sum_{k=lg,la}
(m_{k2}L_{k1}S_{0,k1}+m_{k1}l_{k1}S_{0,k1}+m_{k2}l_{k2}S_{0,k1,k2})\\
&m_{x\theta\theta}=\hat{I}_{0,1,2,3,4}+L_0^2(m_3+m_4)+L_1^2m_2+L_3^2m_4-\\
&2L_0L_3m_4C_3-2L_0l_3m_3C_3+2L_0l_4m_4C_{3,4}+2L_1l_2m_2C_2+2L_3l_4m_4C_4\\
\\
&\mathrm{M}_{b,b} =
\begin{bmatrix}
m_{0,1,2,3,4} &0 &m_{xc\theta}\\
0 &m_{0,1,2,3,4} &m_{xs\theta}\\
m_{xc\theta} &m_{xs\theta} &m_{x\theta\theta}\\
\end{bmatrix}\\
\\
&\mathrm{M}_{b,lg} =
\begin{bmatrix}
m_2L_1C_{0,lg1}+m_1l_1C_{0,lg1}+m_2l_2C_{0,lg1,lg2} &m_2l_2C_{0,lg1,lg2}\\
m_2L_1S_{0,lg1}+m_1l_1S_{0,lg1}+m_2l_2S_{0,lg1,lg2} &m_2l_2S_{0,lg1,lg2}\\
\hat{I}_1+\hat{I}_2+m_2L^2_1+2m_2l_{2}L_1C_{lg2} &\hat{I}_2+m_2l_{2}L_1C_{lg2}
\end{bmatrix} \\
\\

&\mathrm{M}_{b,la} =
\begin{bmatrix}
m_4L_3C_{0,la1}+m_3l_3C_{0,la1}+m_4l_4C_{0,la1,la2} &m_4l_4C_{0,la1,la2}\\
m_4L_3S_{0,la1}+m_3l_3S_{0,la1}+m_4l_4S_{0,la1,la2} &m_4l_4S_{0,la1,la2}\\
\hat{I}_3+\hat{I}_4+L_3^2m_4+2L_3l_4m_4C_{la2}-L_0L_3m_4C_{la1}-L_0l_3m_3C_{la1}-L_0l_4m_4C_{la1,la2}
&\hat{I}_4+L_3l_4m_4C_{la2}-L_0l_4m_4C_{la1,la2}
\end{bmatrix} \\
\\

&\mathrm{M}_{lg,lg}=
\begin{bmatrix}
\hat{I}_1+\hat{I}_2+m_2L^2_1+2m_2l_{2}L_1C_{lg2} &\hat{I}_2+m_2l_{2}L_1C_{lg2}\\
\hat{I}_2+m_2l_{2}L_1C_{lg2} &\hat{I}_2
\end{bmatrix}\\
\\

&\mathrm{M}_{la,la}=
\begin{bmatrix}
\hat{I}_3+\hat{I}_4+m_4L^2_3+2m_4L_3l_4C_{la2} &\hat{I}_4+m_4L_3l_4C_{la2}\\
\hat{I}_4+m_4L_3l_4C_{la2} &\hat{I}_4
\end{bmatrix}\\
\\

\end{aligned}
$$

- 重力项

$$
\begin{aligned}
&\mathrm{G}_b =
\begin{bmatrix}
0 \\ m_{0,1,2,3,4}\\
m_{xs\theta}
\end{bmatrix}\\
\\
&\mathrm{G}_{lg} =
\begin{bmatrix}
(m_2L_1+m_1l_1)S_{0,lg1}+m_2l_2S_{0,lg1,lg2} \\
m_2l_2S_{0,lg1,lg2}
\end{bmatrix}\\
\\
&\mathrm{G}_{la} =
\begin{bmatrix}
(m_4L_3+m_3l_3)S_{0,la1}+m_4l_4S_{0,la1,la2} \\
m_4l_4S_{0,la1,la2}
\end{bmatrix}\\

\end{aligned}
$$

- 离心力项

$$
\begin{aligned}
&m_{bs\theta} = L_0S_0(m_3+m_4)+m_0l_0S_0-\displaystyle\sum_{k=lg,la}(L_{k1}m_{k2}S_{0,k1}+l_{k1}m_{k1}S_{0,k1}+l_{k2}m_{k2}S_{0,k1,k2})\\
\\
&m_{odd,s\theta}=L_{k1}m_{k2}S_{0,k1}+l_{k1}m_{k1}S_{0,k1}+l_{k2}m_{k2}S_{0,k1,k2}\\
\\
&m_{odd,sg\theta}=L_{k1}m_{k2}S_{k1}+l_{k1}m_{k1}S_{k1}+l_{k2}m_{k2}S_{k1,k2}\\
\\
&m_{eve,s\theta}=l_{k2}m_{k2}S_{0,k1,k2}\\
\\
&m_{eve,sg\theta}=l_{k2}m_{k2}S_{k1,k2}\\
\\
&m_{s\theta\theta1}=L_0(L_{k1}m_{k2}S_{k1}+l_{k1}m_{k1}S_{k1}+l_{k2}m_{k2}S_{k1,k2})\\
\\
&m_{s\theta\theta2}=m_{k2}l_{k2}(L_0S_{k1,k2}-L_{k1}S_{k2})\\
\\
&m_{s\theta\theta3}=m_{k2}l_{k2}L_{k1}S_{k2}\\
\\
&\mathrm{C}_b=
\begin{bmatrix}
(m_{bs\theta})\dot{\theta}_0^2-
\displaystyle\sum_{k=lg,la}(2m_{odd,s\theta}\dot{\theta}_0\dot{\theta}_{k1}+2m_{eve,s\theta}\dot{\theta}_0\dot{\theta}_{k2}+
m_{odd,s\theta}\dot{\theta}_{k1}^2+m_{eve,s\theta}\dot{\theta}_{k2}^2+2m_{eve,s\theta}\dot{\theta}_{k1}\dot{\theta}_{k2})\\
-(m_{bc\theta})\dot{\theta}_0^2+
\displaystyle\sum_{k=lg,la}(2m_{odd,c\theta}\dot{\theta}_0\dot{\theta}_{k1}+2m_{eve,c\theta}\dot{\theta}_0\dot{\theta}_{k2}+
m_{odd,c\theta}\dot{\theta}_{k1}^2+m_{eve,c\theta}\dot{\theta}_{k2}^2+2m_{odd,c\theta}\dot{\theta}_{k1}\dot{\theta}_{k2})\\
\displaystyle\sum_{k=la}(2m_{s\theta\theta1}\dot{\theta}_0\dot{\theta}_{k1}+2m_{s\theta\theta2}\dot{\theta}_0\dot{\theta}_{k2}+m_{s\theta\theta1}\dot{\theta}_{k1}^2+m_{s\theta\theta2}\dot{\theta}_{k2}^2+2m_{s\theta\theta2}\dot{\theta}_{k1}\dot{\theta}_{k2})-\displaystyle\sum_{k=lg}(2m_{s\theta\theta3}\dot{\theta}_0\dot{\theta}_{k2}+2m_{s\theta\theta3}\dot{\theta}_{k1}\dot{\theta}_{k2}+m_{s\theta\theta3}\dot{\theta}_{k2}^2)
\end{bmatrix}\\
\\
&\mathrm{C}_{lg}=
\begin{bmatrix}
-2m_{s\theta\theta3,lg}\dot{\theta}_{0}\dot{\theta}_{k2,lg}-2m_{s\theta\theta3,lg}\dot{\theta}_{k1,lg}\dot{\theta}_{k2,la}-m_{s\theta\theta3,lg}\dot{\theta}_{k2,lg}^2\\
m_{s\theta\theta3,lg}\dot{\theta}_{0}^2+2m_{s\theta\theta3,lg}\dot{\theta}_0\dot{\theta}_{k1,lg}+m_{s\theta\theta3,lg}\dot{\theta}_{k1,lg}^2
\end{bmatrix}\\
\\
&\mathrm{C}_{la}=
\begin{bmatrix}
-m_{s\theta\theta1,la}\dot{\theta}_0^2-2m_{s\theta\theta3,la}\dot{\theta}_0\dot{\theta}_{k2,la}-2m_{s\theta\theta3,la}\dot{\theta}_{k1,la}\dot{\theta}_{k2,la}-m_{s\theta\theta3,la}\dot{\theta}_{k2,la}^2\\
-m_{s\theta\theta2,la}\dot{\theta}_0^2+2m_{s\theta\theta3,la}\dot{\theta}_0\dot{\theta}_{k1,la}+m_{s\theta\theta3,la}\dot{\theta}_{k1,la}^2
\end{bmatrix}\\
\\
\end{aligned}
$$





#### Model_Jin+双单摆臂

##### 不同速度下数据对比

- 动力学方程
  $$
  \begin{bmatrix}
  \mathrm{M}_{b,b} &\mathrm{M}_{b,lg} &\mathrm{M}_{b,rg} &\mathrm{M}_{b,la} &\mathrm{M}_{b,ra}\\
  \mathrm{M}^T_{b,lg} &\mathrm{M}_{lg,lg} &\mathrm{0} &\mathrm{0} &\mathrm{0}\\
  \mathrm{M}^T_{b,rg} &\mathrm{0} &\mathrm{M}_{rg,rg} &\mathrm{0} &\mathrm{0}\\
  \mathrm{M}^T_{b,la} &\mathrm{0} &\mathrm{0}&\mathrm{M}_{la,la} &\mathrm{0}\\
  \mathrm{M}^T_{b,ra} &\mathrm{0} &\mathrm{0} &\mathrm{0} &\mathrm{M}_{ra,ra}\\
  \end{bmatrix}
  \begin{bmatrix}
  \ddot{x}\\
  \ddot{y}\\
  \ddot{\theta}_{lg1}\\
  \ddot{\theta}_{lg2}\\
  \ddot{\theta}_{rg1}\\
  \ddot{\theta}_{rg2}\\
  \ddot{\theta}_{la}\\
  \ddot{\theta}_{ra}\\
  \end{bmatrix}
  +
  \begin{bmatrix}
  \mathrm{G}_{b}\\
  \mathrm{G}_{lg}\\
  \mathrm{G}_{rg}\\
  \mathrm{G}_{la}\\
  \mathrm{G}_{ra}\\
  \end{bmatrix}g
  +
  \begin{bmatrix}
  \mathrm{C}_b\\
  \mathrm{C}_{lg}\\
  \mathrm{C}_{rg}\\
  \mathrm{C}_{la}\\
  \mathrm{C}_{ra}\\
  \end{bmatrix}
  =
  \begin{bmatrix}
  0 \\ 0 \\ \tau_{lg1} \\ \tau_{lg2} \\ \tau_{rg1} \\ \tau_{rg2 }\\ \tau_{la} \\ \tau_{ra}
  \end{bmatrix}
  +
  \begin{bmatrix}
  \mathrm{J}_l &\mathrm{J}_r
  \end{bmatrix}
  \begin{bmatrix}
  F_{lx} \\ F_{ly} \\ F_{rx} \\ F_{ry}
  \end{bmatrix}
  $$

  $$
  
  $$

  ![Compare_force_BB_aim10](https://s2.loli.net/2022/07/11/kpRrAz8K7xoZOaw.png)

- 轨迹优化
  $$
  \begin{aligned}
  &\min_{dt,q_i,\dot{q}_i,\tau_i,F_i}{\sum^n_{i=0}(\max{(\dot{q}\tau dt,0)}+\lvert \tau_i \rvert+\lvert F_i\rvert)+\lvert \frac{x_n-x_0}{v_{target}\cdot ndt} \rvert}\\
  &\quad\quad s.t.\quad
  
  \begin{aligned}
  &\color{Crimson}{\left\{
      \begin{aligned}
      &q_{i+1}-q_i-\frac{dt}{2}(\dot{q}_{i+1}+\dot{q}_{i})=0\\
      &M(q_i)(\dot{q}_{i+1}-\dot{q}_i)+F(q_i,\dot{q_i+1})dt-\tau_i dt-J^(q_i)F_idt=0\\
      \end{aligned}
  \right.} &\color{Crimson}{Dynamics}\\
  &\color{Coral}{\left\{
  \begin{aligned}
  &\left\{
      \begin{aligned}
      &\phi_y(q_i)=0\\
      &F_y\mu-\lvert F_x \rvert\ge0\\
      &\dot{\phi}_x(q_i,\dot{q}_i)=0
      \end{aligned}\ stance\ phase
  \right.\\
  &\left\{
      \begin{aligned}
      &\phi_y(q_i)\ge0\\
      &F_{xi}=0\\
      &F_{yi}=0
      \end{aligned}\quad \quad swing\ phase
  \right.
  \end{aligned}
  \right.} &\color{Coral}{Contact}\\
  &\color{LightSeaGreen}{\left\{
      \begin{aligned}
      &q_0-q_n=0\quad(except\ x)\\
      &\dot{q}_0-\dot{q}_n=0\\
      &\ddot{q}_0-\ddot{q}_n=0
      \end{aligned}
  \right.} &\color{LightSeaGreen}{Preiodic}\\
  &\color{DodgerBlue}{\left\{
      \begin{aligned}
      &\underline{q}\le q \le \bar{q}\\
      &\underline{\dot{q}} \le \dot{q} \le \bar{\dot{q}}\\
      &\underline{\tau}(\dot{q})\le \tau \le \bar{\tau}(\dot{q})\\
      \end{aligned}
  \right.} &\color{DodgerBlue}{Boundary}\\
  \end{aligned}
  
  \end{aligned}
  $$
  

| 参数                                                         | 数据图                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| - Vt = 2, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm swing） | <img src="https://s2.loli.net/2022/07/06/u1M52LFkqjCHdoc.png" alt="Traj-Vel-uF" style="zoom:40%;" /><br />2022-07-02-19-52-57-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_2-Tp_0.4-Tst_0.4-config.yaml |
| - Vt = 2, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm bound） | <img src="https://s2.loli.net/2022/07/06/bFhstCV5Q1OZocm.png" alt="Traj-Vel-uF" style="zoom: 40%;" /><br />2022-07-06-10-21-56-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_2-Tp_0.4-Tst_0.4-config.yaml |
| Vt = 5, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm swing） | <img src="https://s2.loli.net/2022/07/06/7x6gGhwztNUQARm.png" alt="Traj-Vel-uF" style="zoom:50%;" /><br />2022-07-06-09-30-18-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_5-Tp_0.26-Tst_0.3-config.yaml |
| Vt = 5, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm bound） | <img src="https://s2.loli.net/2022/07/06/TcqvXm1BwySzYVk.png" alt="Traj-Vel-uF" style="zoom:50%;" /><br />2022-07-06-09-29-45-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_5-Tp_0.26-Tst_0.3-config.yaml |
| Vt = 10, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm swing） | <img src="https://s2.loli.net/2022/07/06/HZXLBQWsaCNfbpA.png" alt="Traj-Vel-uF" style="zoom:40%;" /><br />2022-07-06-10-26-25-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_10-Tp_0.2-Tst_0.26-config.yaml |
| Vt = 10, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm bound） | <img src="https://s2.loli.net/2022/07/06/3R2PJo7BnXQkEGO.png" alt="Traj-Vel-uF" style="zoom:40%;" /><br />2022-07-06-10-27-03-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_10-Tp_0.2-Tst_0.26-config.yaml |





- **不同速度下运动数据和动力学分析**

| 参数                                                         | 数据图                                                       |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Vt = 5, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm swing） | 2022-07-13-11-57-05-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_5-Tp_0.26-Tst_0.3-config.yaml |                                                              |
|                                                              | <img src="https://s2.loli.net/2022/07/13/YwqnA2EHiO6LGmf.png" alt="Traj" style="zoom: 20%;" /> | <img src="https://s2.loli.net/2022/07/13/repABCF8uVRHNz3.png" alt="Pos-Vel-uF" style="zoom: 67%;" /> |
|                                                              | <img src="https://s2.loli.net/2022/07/13/OjPTxwYQ3mEIXol.png" alt="dynamics-eq" style="zoom: 67%;" /> |                                                              |
| Vt = 5, Pc = 0, Fc = 0.6, Sc = 0.2, Ic = 0.2<br />（arm bound） | 2022-07-13-11-57-05-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_5-Tp_0.26-Tst_0.3-config.yaml |                                                              |
|                                                              | <img src="https://s2.loli.net/2022/07/13/eH1QzoFAlWigKcV.png" alt="Traj" style="zoom:25%;" /> | <img src="https://s2.loli.net/2022/07/13/Jtk43UAy1rE7eNS.png" alt="Pos-Vel-uF" style="zoom:67%;" /> |
|                                                              | <img src="https://s2.loli.net/2022/07/13/sgoZUbl37Y6CJwS.png" alt="dynamics-eq" style="zoom:67%;" /> |                                                              |



- **不同速度下运动数据**

  采用人的不太频率和接触占比，修改手臂长度

  | 速度        | Arm swing                                                    | Arm bound                                                    |
  | ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | Vt = 2 m/s  | ![Traj](https://s2.loli.net/2022/07/25/YKHbwWiJnOczpQU.png)<br />2022-07-24-19-05-18-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_2-Tp_0.53-Tst_0.45-config.yaml | <img src="https://s2.loli.net/2022/07/25/Dc7oP3srC9fhwGF.png" alt="Traj" style="zoom: 30%;" /><br />2022-07-24-19-06-03-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_2-Tp_0.53-Tst_0.45-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/uZJ5DSYp73kgK8t.png) | <img src="https://s2.loli.net/2022/07/25/ZJNyoLr8Ek1KmdM.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | Vt = 3 m/s  | ![Traj](https://s2.loli.net/2022/07/25/dRB6gor9C2PfL5A.png)<br />2022-07-24-19-10-34-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_3-Tp_0.46-Tst_0.41-config.yaml | <img src="https://s2.loli.net/2022/07/25/tLUGFx3WcyinCj4.png" alt="Traj" style="zoom:33%;" /><br />2022-07-24-19-11-26-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_3-Tp_0.46-Tst_0.41-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/M4kGut23JPAUnHO.png) | <img src="https://s2.loli.net/2022/07/25/7Zepi9XtVwGKqEu.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | Vt = 4 m/s  | ![Traj](https://s2.loli.net/2022/07/25/xaZO7XHlcCzeQ1g.png)<br />2022-07-24-19-21-09-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_4-Tp_0.46-Tst_0.37-config.yaml | <img src="https://s2.loli.net/2022/07/25/z1FSRWy98imwjZl.png" alt="Traj" style="zoom:33%;" /><br />2022-07-24-19-22-03-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_4-Tp_0.46-Tst_0.37-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/Yl1CDdERUQeV5yN.png) | <img src="https://s2.loli.net/2022/07/25/5W348NwLQRfI1UT.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | Vt = 5 m/s  | ![Traj](https://s2.loli.net/2022/07/25/OaVNeLYJDdFTf7E.png)<br />2022-07-24-19-23-07-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_5-Tp_0.4-Tst_0.34-config.yaml | <img src="https://s2.loli.net/2022/07/25/6eIy7gHhXvmCTa1.png" alt="Traj" style="zoom:33%;" /><br />2022-07-24-19-23-53-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_5-Tp_0.4-Tst_0.34-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/ntUrEHxDQvp2w3S.png) | <img src="https://s2.loli.net/2022/07/25/3SvCaZnOc6yBKXI.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | Vt = 6 m/s  | ![Traj](https://s2.loli.net/2022/07/25/F7VE6TloCBwAi5s.png)<br />2022-07-24-19-24-56-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_6-Tp_0.4-Tst_0.35-config.yaml | <img src="https://s2.loli.net/2022/07/25/lo5HkdvmRM6VCDy.png" alt="Traj" style="zoom:33%;" /><br />2022-07-24-19-26-48-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_6-Tp_0.4-Tst_0.35-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/MPKnQqR6GkJh2XH.png) | <img src="https://s2.loli.net/2022/07/25/LZQbcWdfvx3zw8j.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | Vt = 7 m/s  | ![Traj](https://s2.loli.net/2022/07/25/I5VdiujpK2zUf3A.png)<br />2022-07-24-19-28-23-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_7-Tp_0.4-Tst_0.32-config.yaml | <img src="https://s2.loli.net/2022/07/25/orYtyWGvA6SUP8u.png" alt="Traj" style="zoom:33%;" /><br />2022-07-24-19-29-28-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_7-Tp_0.4-Tst_0.32-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/tBlhaFdZeIqCmkO.png) | <img src="https://s2.loli.net/2022/07/25/JYQNlmHTgPFSskK.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | Vt = 8 m/s  | ![Traj](https://s2.loli.net/2022/07/25/VRHjSiTe1QdKDGw.png)<br />2022-07-24-19-30-37-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_8-Tp_0.35-Tst_0.25-config.yaml | <img src="https://s2.loli.net/2022/07/25/yvZ6qbtFcjA9BLi.png" alt="Traj" style="zoom:33%;" />br /><bar/>2022-07-24-19-31-20-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_8-Tp_0.35-Tst_0.25-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/V8l4IAzuj2xoN6T.png) | <img src="https://s2.loli.net/2022/07/25/buCqJygjBktH9IZ.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | Vt = 9 m/s  | ![Traj](https://s2.loli.net/2022/07/25/GTz83AnUePK6a2o.png)<br />2022-07-24-19-32-23-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_9-Tp_0.35-Tst_0.24-config.yaml | ![Traj](https://s2.loli.net/2022/07/25/bxOPvBqdRCrlmUy.png)<br />2022-07-24-19-33-06-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_9-Tp_0.35-Tst_0.24-config.yaml |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/PXpiNnUmDEqKueO.png) | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/fZvIaBrMyhjTx1e.png) |
  | Vt = 10 m/s | ![Traj](https://s2.loli.net/2022/07/25/udiDspt6YCAH3bO.png)<br/>2022-07-24-19-34-40-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_10-Tp_0.35-Tst_0.23 | ![Traj](https://s2.loli.net/2022/07/25/eRCQyBzVLFgJp1h.png)<br/>2022-07-24-19-35-25-Traj-Tcf_0.0-Pcf_0.0-Fcf_0.6-Scf_0.2-Icf_0.2-Vt_10-Tp_0.35-Tst_0.23 |
  |             | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/xh2ZMKGkT9A3lCb.png) | ![Pos-Vel-uF](https://s2.loli.net/2022/07/25/l1RBfauyUP7EtOF.png) |
  
  - 结果分析：当<font color = 'red'>速度小于4 m/s时，手臂摆动对力和力矩的影响非常小</font>，可以忽略不计
  
    
  
- **不同速度对力和力矩的影响**

  | 速度   | Stance(占比) | T      |
  | ------ | ------------ | ------ |
  | 2 m/s  | 0.45         | 0.53 s |
  | 3 m/s  | 0.41         | 0.46 s |
  | 4 m/s  | 0.37         | 0.46 s |
  | 5 m/s  | 0.34         | 0.40 s |
  | 6 m/s  | 0.35         | 0.40 s |
  | 7 m/s  | 0.32         | 0.40 s |
  | 8 m/s  | 0.25         | 0.35 s |
  | 9 m/s  | 0.24         | 0.35 s |
  | 10 m/s | 0.23         | 0.35 s |

  <img src="https://s2.loli.net/2022/07/25/GDhnURxFjHAgOJq.png" alt="Vel-Force" style="zoom:67%;" />

  - 结果分析：臂摆动时，<font color = 'red'>速度越高，Hip关节力矩越大，对整体趋势而言，足底力Fy和Knee关节力矩越大</font>，虽然存在波动，但是波动可能由于运动周期T的选择有关

  

- **8 m/s时不同步态频率的影响**

  | 周期 T: 0.35 s                                               | 周期 T: 0.50 s                                               |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | Period: 0.35      Stance: 0.25                               | Period: 0.49      Stance: 0.28                               |
  | <img src="https://s2.loli.net/2022/07/25/VRHjSiTe1QdKDGw.png" alt="Traj" style="zoom:33%;" /> | <img src="https://s2.loli.net/2022/07/25/so5EBfIWQ6S1rgO.png" alt="Traj" style="zoom:33%;" /> |
  | <img src="https://s2.loli.net/2022/07/25/V8l4IAzuj2xoN6T.png" alt="Pos-Vel-uF" style="zoom:33%;" /> | <img src="https://s2.loli.net/2022/07/25/HzGguCOhtxAUa8j.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |
  | <img src="https://s2.loli.net/2022/07/25/ZeHgK7s6GrU38Mf.png" alt="dyanmics-arm-0.35" style="zoom:33%;" /> | <img src="https://s2.loli.net/2022/07/25/dkV15CDq6nyRjYA.png" alt="dyanmics-arm-0.49" style="zoom:33%;" /> |
  | <img src="https://s2.loli.net/2022/07/25/yvZ6qbtFcjA9BLi.png" alt="Traj" style="zoom:33%;" />br /> | <img src="https://s2.loli.net/2022/07/25/f5RkxDoiqZ84sVu.png" alt="Traj" style="zoom:33%;" /> |
  | <img src="https://s2.loli.net/2022/07/25/buCqJygjBktH9IZ.png" alt="Pos-Vel-uF" style="zoom:33%;" /> | <img src="https://s2.loli.net/2022/07/25/89u2JZNasB4MEDG.png" alt="Pos-Vel-uF" style="zoom:33%;" /> |

  - 结果分析：
    - 采用<font color = 'red'>人体运动频率</font>时，臂摆动相对于束缚，<font color = 'red'>足底力和关节力矩变化不大</font>
    - 运动<font color = 'red'>频率越高</font>，手臂的<font color = 'red'>耦合作用效果越明显</font>。
    - 为了充分发挥手臂的耦合作用，相比较于人体的运动频率，<font color = 'red'>机器人的运动频率需要更高</font>。



- **8 m/s时不同的质量和惯量对力和力矩的影响**

  <img src="https://s2.loli.net/2022/07/25/9Pya2fZXnWJ5LhR.png" alt="ForceMap2" style="zoom: 80%;" />

  ![Figure_1](https://s2.loli.net/2022/07/27/78pcVXgUjDtSaof.png)

  - 结果分析： 从质量分布图中，难以获得非常明显的规律和信息，金师兄说可以考虑不用<font color = 'red'>峰值数据，而是均值数据</font>

    <font color='DeepSkyBlue' size='6'>(^o^ !)嘿嘿，质量分布图初步结果总算有了，不管结果如何，已经迈出了巨大的一步， 加油！！！</font>
  
  
  
  - 基于均值数据的惯性参数-力分布图
  
    ![ForceMap11-MV](https://s2.loli.net/2022/07/28/8Enbd7iRJc4ygmo.png)
  
  

##### 稳定恢复数据对比

- 控制器
  $$
  \begin{aligned}
  &\min_{q_i,\dot{q}_i,\tau_i,F_i}{\sum^n_{i=0}(\max{(\dot{q}\tau dt,0)}+\lvert \tau_i \rvert+\lvert F_i\rvert+\lvert q_i-q_{tar} \rvert)}\\
  &\quad\quad s.t.\quad
  
  \begin{aligned}
  &\color{Crimson}{\left\{
      \begin{aligned}
      &q_{i+1}-q_i-\frac{dt}{2}(\dot{q}_{i+1}+\dot{q}_{i})=0\\
      &M(q_i)(\dot{q}_{i+1}-\dot{q}_i)+F(q_i,\dot{q_i+1})dt-\tau_i dt-J^(q_i)F_idt=0\\
      \end{aligned}
  \right.} &\color{Crimson}{Dynamics}\\
  &\color{Coral}{\left\{
  \begin{aligned}
  &F_z\mu-\lvert F_x \rvert\ge0\\
  &x_{lf,rf}=0\\
  &z_{lf,rf}=0
  \end{aligned}
  \right.} &\color{Coral}{Contact}\\
  &\color{DodgerBlue}{\left\{
      \begin{aligned}
      &q_0=q_{init}\\
      &\underline{q}\le q \le \bar{q}\\
      &\underline{\dot{q}} \le \dot{q} \le \bar{\dot{q}}\\
      &\underline{\tau}(\dot{q})\le \tau \le \bar{\tau}(\dot{q})\\
      \end{aligned}
  \right.} &\color{DodgerBlue}{Boundary}\\
  \end{aligned}
  
  \end{aligned}
  $$
  

